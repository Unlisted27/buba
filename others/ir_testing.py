#!/usr/bin/env python3
import pigpio
import time

#pulse_data = [3460, 1630, 585, 410, 455, 985, 105, 115, 520, 440, 460, 415, 431, 444, 2205, 410, 465, 412, 2303, 260, 515, 415, 500, 1165, 540, 415, 500, 375, 547, 323, 600, 165, 570, 160, 715, 375, 495, 375, 2505, 1030, 1415, 330, 460, 415, 455, 450, 425, 415, 570, 220, 2640, 940, 455, 325, 560, 1276, 524, 1095, 586, 1289, 460, 1290, 580, 291, 459, 350, 525, 1285, 460, 415, 555, 1080, 581, 1280, 404, 775, 260, 305, 465, 1180, 585, 390, 460, 1290, 520, 74372, 3464, 1690, 490, 445, 455, 710, 195, 385, 435, 335, 560, 415, 460, 150, 725, 416, 519, 220, 565, 440, 530, 270, 1435, 385, 455, 420, 530, 340, 645, 1105, 455, 415, 460, 375, 615, 295, 465, 416, 424, 445, 1515, 180, 590, 335, 1335, 1095, 645, 420, 466, 394, 470, 420, 1325, 415, 530, 145, 685, 390, 460, 410, 780, 895, 505, 445, 450, 1035, 715, 1255, 585, 1200, 455, 1290, 460, 415, 400, 470, 655, 1096, 509, 360, 470, 1270, 465, 1250, 505, 1185, 555, 1275, 640, 210, 495, 1290, 610, 74280, 3490, 1725, 460, 346, 524, 1290, 520, 175, 725, 325, 460, 310, 565, 415, 460, 410, 460, 415, 460, 415, 460, 225, 1495, 440, 455, 415, 460, 1275, 475, 416, 1329, 285, 1490, 385, 455, 420, 460, 360, 515, 410, 465, 320, 545, 1240, 510, 320, 550, 420, 465, 377, 488, 335, 1415, 395, 535, 240, 670, 320, 525, 1120, 560, 415, 462, 1289, 449, 1280, 475, 1285, 490, 1245, 680, 125, 535, 420, 455, 1290, 460, 365, 545, 1240, 460, 1300, 435, 1310, 460, 1285, 460, 415, 455, 1005, 830, 2250, 185, 71915, 3485, 1730, 455, 417, 458, 1290, 490, 380, 595, 240, 497, 348, 525, 370, 530, 375, 475, 365, 505, 415, 540, 235, 560, 410, 460, 415, 465, 411, 454, 1255, 495, 415, 455, 420, 455, 415, 460, 417, 453, 420, 450, 420, 466, 339, 710, 110, 610, 390, 455, 1236, 514, 415, 455, 386, 489, 415, 455, 420, 455, 420, 431, 439, 455, 420, 455, 350, 521, 1265, 459, 445, 455, 1290, 460, 1285, 455, 1290, 485, 1266, 459, 415, 455, 375, 497, 1294, 454, 415, 485, 1260, 460, 1290, 485, 1260, 460, 1290, 455, 420, 456, 1289, 456, 74435, 3485, 1730, 455, 420, 455, 1290, 455, 420, 550, 320, 455, 395, 480, 421, 479, 360, 485, 360, 515, 420, 455, 390, 455, 445, 460, 415, 455, 415, 485, 1255, 465, 420, 455, 390, 480, 420, 455, 420, 455, 415, 485, 390, 455, 420, 455, 360, 515, 400, 465, 1265, 460, 445, 515, 330, 485, 440, 500, 325, 480, 420, 505, 295, 530, 415, 455, 420, 455, 1290, 460, 405, 465, 1275, 500, 1265, 450, 1295, 455, 1290, 430, 445, 455, 420, 455, 1291, 454, 420, 455, 1290, 455, 1285, 460, 1295, 455, 1290, 455, 420, 455, 1290, 460, 74435, 3485, 1725, 455, 420, 455, 1290, 510, 365, 510, 365, 455, 410, 465, 415, 460, 416, 454, 420, 455, 390, 485, 415, 455, 415, 460, 420, 455, 415, 455, 1295, 450, 420, 455, 420, 450, 445, 430, 420, 455, 365, 505, 420, 455, 420, 455, 420, 480, 390, 457, 1313, 455, 400, 450, 420, 455, 420, 455, 420, 455, 415, 455, 420, 455, 420, 425, 445, 455, 1295, 480, 390, 455, 1295, 455, 1290, 455, 1240, 505, 1295, 455, 421, 449, 425, 450, 1315, 435, 420, 450, 1290, 460, 1315, 455, 1270, 450, 1305, 440, 426, 449, 1320, 425, 2999208, 130, 2955, 110]
pulse_data = [9000, 4500, 560, 560, 560, 1690]  # Typical NEC header + 2 bits
IR_GPIO = 19
freq = 38000
duty_cycle = 2**15  # realistic IR LED duty cycle

pi = pigpio.pi()
if not pi.connected:
    raise RuntimeError("Failed to connect to pigpiod.")
#Formatting proper pulses
pulses = []
on = True
for duration in pulse_data:
    if on:
        pulses.append(pigpio.pulse(gpio_on=1 << IR_GPIO, gpio_off=0, delay=duration))
    else:
        pulses.append(pigpio.pulse(gpio_on=0, gpio_off=1 << IR_GPIO, delay=duration))
    on = not on  # toggle between on and off

pi.set_mode(IR_GPIO, pigpio.OUTPUT)
pi.write(IR_GPIO, 1)
time.sleep(2)
result = pi.hardware_PWM(IR_GPIO, freq, duty_cycle)
if result != 0:
    print(result)
else:
    print("hardware_PWM success!")

#pi.wave_clear()
#pi.wave_add_generic(pulses)
#wave_id = pi.wave_create()
#if not (result >= 0):
#    print(result)
#else: print("Wave created succesfully!")
#
#pi.wave_send_repeat(wave_id)
time.sleep(5)
#pi.wave_tx_stop()
pi.stop()
